// Generated by CoffeeScript 1.4.0
(function() {

  LOAF.SingleItemView = LOAF.BreadcrumbView.extend({
    tagName: 'div',
    className: 'bcrumbs-single-view',
    current: 'info',
    initialize: function(options) {
      this.title = this.model.get("name");
      return this.initHistory(options);
    },
    render: function() {
      var checkboxes, html,
        _this = this;
      html = Mustache.render(LOAF.templates.bcSingleItem, (this.model ? this.model.attributes : {}));
      this.$el.html(html);
      checkboxes = "";
      _.each(LOAF.customLists.getLists(), function(list) {
        var obj;
        obj = {
          id: list.id,
          name: list.name
        };
        obj.checked = _.contains(_this.model.get("listIds"), obj.id);
        return checkboxes += Mustache.render(LOAF.templates.bcListCheckboxS, obj);
      });
      this.$(".bc-list-checkboxes").html(checkboxes);
      return this.renderHistory();
    },
    events: {
      "click .bcrumbs-single-item-info-link": "showInfo",
      "click .bcrumbs-single-item-notes-link": "showNotes",
      "click .bcrumbs-single-item-lists-link": "showLists",
      "click .bcrumbs-single-item-reviews-link": "showReviews",
      "click .bcrumbs-single-item-section-notes .btn-info": "saveNotes",
      "keypress textarea": "changeNotes",
      "click .bc-list-checkbox": "onCheckToggle"
    },
    saveNotes: function(e) {
      var note_text;
      note_text = this.$(".bcrumbs-single-item-section-notes textarea").val();
      this.model.set("notes", note_text);
      this.$(".bcrumbs-single-item-section-notes .btn-info").addClass("btn-success");
      this.$(".bcrumbs-single-item-section-notes .btn-info").removeClass("btn-info");
      return LOAF.appView.saveApplication();
    },
    changeNotes: function() {
      return this.$(".bcrumbs-single-item-section-notes .btn-success").addClass("btn-info").removeClass("btn-success");
    },
    onCheckToggle: function(e) {
      var allCrumbsCheck, chkbx, listId,
        _this = this;
      chkbx = $(e.srcElement);
      listId = e.srcElement.dataset.id;
      if (chkbx.prop("checked")) {
        LOAF.allCrumbsList.add(this.model);
        allCrumbsCheck = _.find(this.$(".bc-list-checkbox"), function(eachCheck) {
          return eachCheck.dataset.id === "0";
        });
        $(allCrumbsCheck).prop("checked", true);
        return LOAF.customLists.where({
          id: parseInt(listId)
        })[0].add(this.model);
      } else {
        LOAF.customLists.where({
          id: parseInt(listId)
        })[0].remove(this.model);
        if (listId === "0") {
          _.each(this.model.get("listIds"), function(id) {
            var list;
            list = LOAF.customLists.where({
              id: id
            })[0];
            if (list != null) {
              list.remove(_this.model.id);
              return _this.model.attributes.listIds = _.without(_this.model.attributes.listIds, list.id);
            }
          });
          return this.$(".bc-list-checkbox").prop("checked", false);
        }
      }
    },
    showInfo: function() {
      if (this.current !== 'info') {
        $(".bcrumbs-single-item-section-info").show();
        $(".bcrumbs-single-item-section-notes").hide();
        $(".bcrumbs-single-item-section-lists").hide();
        $(".bcrumbs-single-item-section-reviews").hide();
        $(".bcrumbs-single-item-tab").removeClass('active');
        $(".bcrumbs-single-item-info-link").addClass('active');
      }
      return this.current = 'info';
    },
    showNotes: function() {
      if (this.current !== 'notes') {
        $(".bcrumbs-single-item-section-info").hide();
        $(".bcrumbs-single-item-section-notes").show();
        $(".bcrumbs-single-item-section-lists").hide();
        $(".bcrumbs-single-item-section-reviews").hide();
        $(".bcrumbs-single-item-tab").removeClass('active');
        $(".bcrumbs-single-item-notes-link").addClass('active');
      }
      return this.current = 'notes';
    },
    showLists: function() {
      if (this.current !== 'lists') {
        $(".bcrumbs-single-item-section-info").hide();
        $(".bcrumbs-single-item-section-notes").hide();
        $(".bcrumbs-single-item-section-lists").show();
        $(".bcrumbs-single-item-section-reviews").hide();
        $(".bcrumbs-single-item-tab").removeClass('active');
        $(".bcrumbs-single-item-lists-link").addClass('active');
      }
      return this.current = 'lists';
    },
    showReviews: function() {
      if (this.current !== 'reviews') {
        $(".bcrumbs-single-item-section-info").hide();
        $(".bcrumbs-single-item-section-notes").hide();
        $(".bcrumbs-single-item-section-lists").hide();
        $(".bcrumbs-single-item-section-reviews").show();
        $(".bcrumbs-single-item-tab").removeClass('active');
        $(".bcrumbs-single-item-reviews-link").addClass('active');
      }
      return this.current = 'reviews';
    }
  });

}).call(this);
