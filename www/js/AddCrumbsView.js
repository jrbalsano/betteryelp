// Generated by CoffeeScript 1.4.0
(function() {

  LOAF.AddCrumbsView = LOAF.BreadcrumbView.extend({
    tagName: 'div',
    className: 'bcrumbs-yelp-view',
    initialize: function() {
      this.state = {};
      this.state.browseExpanded = false;
      return this._historyRep = new LOAF.HistoryItem({
        title: "Add Crumbs",
        view: this
      });
    },
    events: {
      "click .bcrumbs-browse-category-toggle": "onCategoryToggle",
      "click .bcrumbs-browse-collapse": "onCategoryToggle",
      "click .bcrumbs-list a": "onShowList",
      "click .bcrumbs-yelp-search .add-on": "searchForCrumbs"
    },
    searchForCrumbs: function(e) {
      var el, searchResults, searchTerm,
        _this = this;
      e.preventDefault();
      el = $(".bcrumbs-list-view");
      searchTerm = $(".bcrumbs-yelp-search-input").val();
      if (searchTerm) {
        searchResults = new LOAF.YelpList([], {
          term: searchTerm
        });
        return searchResults.fetch({
          success: function() {
            LOAF.yelpLists.addList(searchResults);
            if (LOAF.singleListView != null) {
              LOAF.singleListView.undelegateEvents();
            }
            LOAF.singleListView = new LOAF.SingleListView({
              collection: searchResults,
              el: el,
              caller: _this._historyRep,
              type: "yelp"
            });
            LOAF.singleListView.render();
            $(".bcrumbs-view").hide();
            el.show();
            LOAF.singleListView.postRender();
            $(".edit-toggle").hide();
            $(".edit-mode").hide();
          }
        });
      }
    },
    onShowList: function(e) {
      var el, listId;
      e.preventDefault;
      listId = parseInt(e.srcElement.dataset.id);
      el = $(".bcrumbs-list-view");
      if (LOAF.singleListView != null) {
        LOAF.singleListView.undelegateEvents();
      }
      LOAF.singleListView = new LOAF.SingleListView({
        collection: LOAF.yelpLists.where({
          id: listId
        })[0],
        el: el,
        caller: this._historyRep,
        type: "yelp"
      });
      LOAF.singleListView.render();
      this.$el.hide();
      el.show();
      LOAF.singleListView.postRender();
      $(".edit-toggle").hide();
      $(".edit-mode").hide();
    },
    onCategoryToggle: function(e) {
      e.preventDefault;
      if (this.state.browseExpanded) {
        this.$(".bcrumbs-browse-category-toggle h3").html("Browse Categories +");
        _.each(this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing"), function(o, i) {
          if (i > 2) {
            return $(o).hide();
          }
        });
        this.$(".bcrumbs-browse-collapse").hide();
        return this.state.browseExpanded = false;
      } else {
        this.$(".bcrumbs-browse-category-toggle h3").html("Browse Categories -");
        this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing").show();
        this.$(".bcrumbs-browse-collapse").show();
        return this.state.browseExpanded = true;
      }
    },
    render: function() {
      var categoryHtml;
      categoryHtml = "";
      _.each(LOAF.yelpLists.getLists(), function(list) {
        var obj;
        obj = {
          name: list.category,
          image1: list.size() > 0 ? list.models[0].get("image_url") : void 0,
          image2: list.size() > 1 ? list.models[1].get("image_url") : void 0,
          image3: list.size() > 2 ? list.models[2].get("image_url") : void 0,
          id: list.id
        };
        return categoryHtml += Mustache.render(LOAF.templates.bcListViewList, obj);
      });
      this.$(".bcrumbs-browse-items").html(categoryHtml);
      _.each(this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing"), function(o, i) {
        if (i > 2) {
          return $(o).hide();
        }
      });
      this.$(".bcrumbs-browse-collapse").hide();

      if ((LOAF.yelpLists.where({
        "term": false
      })).length === 0) {
        this.$(".bcrumbs-recent-searches-section").hide();
      }
      this.$(".bcrumbs-recent-searches-collapse").hide();

      return this;
    }
  });

}).call(this);
