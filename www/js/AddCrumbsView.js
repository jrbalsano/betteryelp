// Generated by CoffeeScript 1.4.0
(function() {

  LOAF.AddCrumbsView = LOAF.BreadcrumbView.extend({
    tagName: 'div',
    className: 'bcrumbs-yelp-view',
    initialize: function() {
      this.state = {};
      this.state.browseExpanded = false;
      return this._historyRep = new LOAF.HistoryItem({
        title: "Add Crumbs",
        view: this
      });
    },
    events: {
      "click .bcrumbs-browse-category-toggle": "onCategoryToggle",
      "click .bcrumbs-browse-collapse": "onCategoryToggle",
      "click .bcrumbs-list a": "onShowList"
    },
    onShowList: function(e) {
      var el, listId, singleListView;
      e.preventDefault;
      listId = parseInt(e.srcElement.dataset.id);
      el = $(".bcrumbs-list-view");
      singleListView = new LOAF.SingleListView({
        collection: LOAF.yelpLists.where({
          id: listId
        })[0],
        el: el,
        caller: this._historyRep
      });
      singleListView.render();
      this.$el.hide();
      return el.show();
    },
    onCategoryToggle: function(e) {
      e.preventDefault;
      if (this.state.browseExpanded) {
        this.$(".bcrumbs-browse-category-toggle h3").html("Browse Categories +");
        _.each(this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing"), function(o, i) {
          if (i > 2) {
            return $(o).hide();
          }
        });
        this.$(".bcrumbs-browse-collapse").hide();
        return this.state.browseExpanded = false;
      } else {
        this.$(".bcrumbs-browse-category-toggle h3").html("Browse Categories -");
        this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing").show();
        this.$(".bcrumbs-browse-collapse").show();
        return this.state.browseExpanded = true;
      }
    },
    render: function() {
      var categoryHtml;
      categoryHtml = "";
      _.each(LOAF.yelpLists.getLists(), function(list) {
        var obj;
        obj = {
          name: list.category,
          image1: list.size() > 0 ? list.models[0].get("image_url") : void 0,
          image2: list.size() > 1 ? list.models[1].get("image_url") : void 0,
          image3: list.size() > 2 ? list.models[2].get("image_url") : void 0,
          id: list.id
        };
        return categoryHtml += Mustache.render(LOAF.templates.bcListViewList, obj);
      });
      this.$(".bcrumbs-browse-items").html(categoryHtml);
      _.each(this.$(".bcrumbs-browse-items >.bcrumbs-list.bcrumbs-listing"), function(o, i) {
        if (i > 2) {
          return $(o).hide();
        }
      });
      this.$(".bcrumbs-browse-collapse").hide();
      if ((LOAF.yelpLists.where({
        "term": false
      })).length === 0) {
        this.$(".bcrumbs-recent-searches-section").hide();
      }
      this.$(".bcrumbs-recent-searches-collapse").hide();
      return this;
    }
  });

}).call(this);
