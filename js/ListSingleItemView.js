// Generated by CoffeeScript 1.4.0
(function() {

  LOAF.ListSingleItemView = Backbone.View.extend({
    tagName: "div",
    className: "bcrumbs-single-list-item bcrumbs-listing",
    initialize: function(options) {
      this.current = "none";
      return this.template = options.template;
    },
    events: {
      "mouseover .bcrumbs-mouseover-info": "onShowInfo",
      "mouseover .bcrumbs-mouseover-plus": "onShowAdd",
      "mouseover .bcrumbs-mouseover-edit": "onShowEdit",
      "mouseover .bcrumbs-mouseover-list": "onShowLists",
      "mouseover .bcrumbs-mouseover-star": "onShowReviews",
      "mouseover .bcrumbs-mouseover-trash": "onShowDelete",
      "click .bcrumbs-mouseover-info": "onClickInfo",
      "click .bcrumbs-mouseover-plus": "onClickAdd",
      "click .bcrumbs-mouseover-ok": "onClickRemove",
      "click .bcrumbs-mouseover-edit": "onClickEdit",
      "click .bcrumbs-mouseover-list": "onClickLists",
      "click .bcrumbs-mouseover-star": "onClickReviews",
      "click .bcrumbs-mouseover-trash": "onClickDelete",
      "mouseout .bcrumbs-single-icons": "onExit",
      "click .bc-list-checkbox": "onCheckToggle",
      "click .btn-info": "saveNotes",
      "keypress textarea": "changeNote",
      "click .close": "closeHover"
    },
    closeHover: function() {
      this.$(".btn").removeClass("active");
      this.$('.img-overlay-text').hide();
      this.$('.img-overlay').hide();
      return this.current = "none";
    },
    changeNote: function(e) {
      return this.$(".btn-success").addClass("btn-info").removeClass("btn-success");
    },
    saveNotes: function(e) {
      var note_text;
      note_text = this.$("textarea").val();
      this.model.set("notes", note_text);
      this.$(".btn-info").addClass("btn-success");
      this.$(".btn-info").removeClass("btn-info");
      return LOAF.appView.saveApplication();
    },
    onClickInfo: function(e) {
      this.$(".btn").removeClass("active");
      if (this.current === "info") {
        return this.current = "none";
      } else {
        this.$(".bcrumbs-mouseover-info").button('toggle');
        this.current = "info";
        return this.onShowInfo(e);
      }
    },
    onClickLists: function(e) {
      this.$(".btn").removeClass("active");
      if (this.current === "lists") {
        return this.current = "none";
      } else {
        this.current = "lists";
        this.$(".bcrumbs-mouseover-list").button('toggle');
        return this.onShowLists(e);
      }
    },
    onClickReviews: function(e) {
      this.$(".btn").removeClass("active");
      if (this.current === "reviews") {
        return this.current = "none";
      } else {
        this.current = "reviews";
        this.$(".bcrumbs-mouseover-star").button('toggle');
        return this.onShowReviews(e);
      }
    },
    onClickAdd: function(e) {
      var allCrumbsBox;
      this.$(".icon-plus").addClass("icon-ok").removeClass("icon-plus");
      this.$(".add-message").empty().append("Added to your Crumbs!");
      LOAF.allCrumbsList.add(this.model);
      allCrumbsBox = _.filter(this.$('.bc-list-checkbox'), function(chkbx) {
        return chkbx.dataset.id === "0";
      });
      return $(allCrumbsBox[0]).prop("checked", "checked");
    },
    onClickRemove: function(e) {
      var _this = this;
      console.log("onclick");
      this.$(".icon-ok").addClass("icon-plus").removeClass("icon-ok");
      LOAF.allCrumbsList.remove(this.model);
      this.model;
      _.each(this.model.get("listIds"), function(id) {
        var list;
        list = LOAF.customLists.where({
          id: id
        })[0];
        if (list != null) {
          list.remove(_this.model.id);
          return _this.model.attributes.listIds = _.without(_this.model.attributes.listIds, list.id);
        }
      });
      return this.$(".bc-list-checkbox").prop("checked", false);
    },
    onClickEdit: function() {
      this.$(".btn").removeClass("active");
      if (this.current === "notes") {
        return this.current = "none";
      } else {
        this.$(".bcrumbs-mouseover-edit").button('toggle');
        return this.current = "notes";
      }
    },
    onClickDelete: function() {
      var index,
        _this = this;
      this.$el.hide();
      index = this.collection.indexOf(this.model);
      this.collection.remove(this.model);
      return LOAF.appView.setUndo("" + this.model.name + " removed from " + this.collection.name + ".", "Undo?", function() {
        _this.collection.add(_this.model, {
          at: index
        });
        return _this.$el.show();
      });
    },
    onShowInfo: function() {
      if (this.current === "info" || this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-info").show();
      }
    },
    onShowAdd: function() {
      if (this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-add").show();
      }
    },
    onShowLists: function() {
      if (this.current === "lists" || this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-lists").show();
      }
    },
    onShowReviews: function() {
      if (this.current === "reviews" || this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-reviews").show();
      }
    },
    onShowEdit: function() {
      if (this.current === "edit" || this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-notes").show();
      }
    },
    onShowDelete: function() {
      if (this.current === "delete" || this.current === "none") {
        this.$(".img-overlay-text >span").hide();
        this.$(".img-overlay-text").show();
        this.$(".img-overlay").show();
        return this.$(".bc-list-view-single-delete").show();
      }
    },
    onExit: function() {
      if (this.current === "none") {
        this.$(".img-overlay-text").hide();
        return this.$(".img-overlay").hide();
      }
    },
    onCheckToggle: function(e) {
      var allCrumbsCheck, chkbx, el, listId,
        _this = this;
      chkbx = $(e.srcElement);
      listId = e.srcElement.dataset.id;
      if (listId === "0") {
        el = this.$(".icon-plus, .icon-ok");
        el.toggleClass("icon-ok").toggleClass("icon-plus");
      }
      if (chkbx.prop("checked")) {
        LOAF.allCrumbsList.add(this.model);
        allCrumbsCheck = _.find(this.$(".bc-list-checkbox"), function(eachCheck) {
          return eachCheck.dataset.id === "0";
        });
        $(allCrumbsCheck).prop("checked", true);
        el = this.$(".icon-plus, .icon-ok");
        el.removeClass("icon-plus").removeClass("icon-ok").addClass("icon-ok");
        return LOAF.customLists.where({
          id: parseInt(listId)
        })[0].add(this.model);
      } else {
        LOAF.customLists.where({
          id: parseInt(listId)
        })[0].remove(this.model);
        if (listId === "0") {
          try {
            return _.each(this.model.get("listIds"), function(id) {
              var list;
              list = LOAF.customLists.where({
                id: id
              })[0];
              if (list != null) {
                list.remove(_this.model.id);
                return _this.model.attributes.listIds = _.without(_this.model.attributes.listIds, list.id);
              }
            });
          } finally {
            this.$(".bc-list-checkbox").prop("checked", false);
          }
        }
      }
    },
    render: function() {
      var checkboxes,
        _this = this;
      this.$el.html(Mustache.render(this.template, this.model.attributes));
      checkboxes = "";
      _.each(LOAF.customLists.getLists(), function(list) {
        var obj;
        obj = {
          id: list.id,
          name: list.name
        };
        obj.checked = _.contains(_this.model.get("listIds"), obj.id);
        return checkboxes += Mustache.render(LOAF.templates.bcListCheckboxS, obj);
      });
      this.$(".bc-list-checkboxes").html(checkboxes);
      if (LOAF.allCrumbsList.get(this.model.id)) {
        this.$(".icon-plus").addClass("icon-ok").removeClass("icon-plus");
      }
      return this;
    }
  });

}).call(this);
